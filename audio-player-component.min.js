(() => {
  // audio-player-component.ts
  var m = {
    aac: "audio/aac",
    caf: "audio/caf; codecs=opus",
    mp3: "audio/mp3",
    mp4: "audio/mp4",
    m4a: "audio/mp4",
    oga: "audio/ogg; codecs=vorbis",
    ogg: "audio/ogg; codecs=vorbis",
    opus: "audio/ogg; codecs=opus",
    wav: "audio/wave",
    webm: "audio/webm"
  }, p = class e extends HTMLElement {
    #s;
    #e;
    #a;
    #n;
    #t = document.createElement("audio");
    #i = null;
    #r = !1;
    #l = !1;
    #o;
    static get observedAttributes() {
      return [
        "title",
        "artist",
        "image",
        "compact",
        "blurred",
        "min-height",
        "sources",
        "colour",
        "dark",
        "length-secs"
      ];
    }
    static get svgPlay() {
      return '<svg xmlns="https://www.w3.org/2000/svg" width="24" height="24" viewBox="-1 0 23 24"><title>Play</title><polygon class="icon-play" points="19.05 12 6 3.36 6 20.64 19.05 12"/></svg>';
    }
    static get svgPause() {
      return '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><title>Pause</title><g><rect class="icon-pause" x="6" y="3" width="4" height="18"/><rect class="icon-pause" x="14" y="3" width="4" height="18"/></g></svg>';
    }
    static get svgLoading() {
      return '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" class="loading"><circle cx="12" cy="4" r="2.5"/><circle cx="6" cy="6" r="2.25"/><circle cx="4" cy="12" r="2"/><circle cx="6" cy="18" r="1.75"/><circle cx="12" cy="20" r="1.5"/><circle cx="18" cy="18" r="1.25"/><circle cx="20" cy="12" r="1"/><circle cx="18" cy="6" r="0.75"/></svg>';
    }
    static get svgPlus() {
      return '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><title>Add to Queue</title><polygon points="21,10 14,10 14,3 10,3 10,10 3,10 3,14 10,14 10,21 14,21 14,14 21,14 "/></svg>';
    }
    constructor() {
      super(), this.#o = this.attachShadow({ mode: "open" }), this.#s = this.getAttribute("title"), this.#e = this.getAttribute("artist"), this.#a = this.getAttribute("album"), this.#n = this.getAttribute("compact") !== null;
      let t = this.getAttribute("preload") ?? "auto";
      (t === "" || t === "none" || t === "auto" || t === "metadata") && (this.#t.preload = t);
      let a = this.getAttribute("sources")?.split(",") ?? [];
      this.loadAudio(a), this.#t.onended = () => {
        this.#t.currentTime = 0, this.#r = !1, this.#i.innerHTML = e.svgPlay;
      }, this.#t.style.display = "none";
    }
    static padTime(t) {
      return t < 10 ? `0${t}` : t.toString();
    }
    static createElement({ tagName: t = "div", className: a = "", ...i } = {}) {
      let s = document.createElement(t);
      s.className = a;
      for (let [l, o] of Object.entries(i))
        s[l] = o;
      return s;
    }
    loadAudio(t) {
      if (t.length === 1) {
        this.#t.src = t[0];
        return;
      }
      for (let a of t) {
        let i = a.split(".").pop(), s = m[i ?? "mp3"];
        if (!s) {
          console.warn(`Could not find MIME-type for '${i}' type. Skipping.`);
          continue;
        }
        this.#t.appendChild(
          e.createElement({
            tagName: "source",
            src: a,
            type: s
          })
        );
      }
    }
    get styleCss() {
      return `
		* { line-height: 1; margin: 0; padding: 0; box-sizing: border-box; }
		.tap--container {
			width: 100%;
			position: relative;
			display: flex;
			flex-direction: column;
			overflow: hidden;
			border-radius: 32px;
			box-shadow: 0 2px 16px rgba(0, 0, 0, 0.25);
			justify-content: flex-end;
		}

		.tap--overlay {
			background: linear-gradient(rgba(0, 0, 0, 0) 0%, rgba(0, 0, 0, 0.5) 100%);
			position: absolute;
			width: 100%;
			height: 100%;
			z-index: -998;
		}

		.tap--img {
			position: absolute;
			width: 100%;
			height: 100%;
			object-fit: cover;
			z-index: -999;
		}

		.tap--img.blurred {
			filter: blur(16px);
		}

		.tap--metadata {
			display: flex;
			flex-direction: column;
			margin: 32px;
			color: #fff;
			user-select: none;
			text-shadow: 0 2px 8px rgba(0, 0, 0, 0.4);
		}

		.tap--metadata__title {
			font-size: 32px;
			font-weight: 700;
			display: block;
			margin-bottom: 16px;
		}

		.tap--metadata__artist {
			font-size: 28px;
			font-weight: 400;
		}

		.tap--container .tap--controls {
			margin: 0 16px 16px;
		}

		.tap--controls {
			display: flex;
			background-color: var(--audio-player-controls-bg);
			border-radius: 32px;
			height: 64px;
			align-items: center;
			color: var(--audio-player-text);
			border: 2px solid var(--audio-player-controls-border);

			--audio-player-controls-bg: #f9f9f9;
			--audio-player-controls-border: #ccc;
			--audio-player-button: #fff;
			--audio-player-button-hover: #f9f9f9;
			--audio-player-border: #999;
			--audio-player-border-hover: #666;
			--audio-player-progress: #f0f0f0;
			--audio-player-text: #333;
		}
		.tap--controls.dark {
			--audio-player-controls-bg: #222;
			--audio-player-controls-border: #ccc;
			--audio-player-button: #333;
			--audio-player-button-hover: #555;
			--audio-player-border: #aaa;
			--audio-player-border-hover: #bbb;
			--audio-player-progress: #555;
			--audio-player-text: #fff;
		}

		.controls-text {
			display: inline-block;
			margin-right: 16px;
		}

		.tap--button {
			cursor: pointer;
			font-size: 24px;
			border-radius: 24px;
			width: 48px;
			height: 48px;
			position: relative;
			margin: 0 8px;
			background-color: var(--audio-player-button);
		}

		.tap--button:hover {
			border: 2px solid var(--audio-player-border-hover);
			background-color: var(--audio-player-button-hover);
		}

		.tap--button,
		.tap--progress--bar {
			border: 2px solid var(--audio-player-border);
		}

		.tap--button svg {
			position: absolute;
			top: 12.5%;
			left: 12.5%;
			width: 75%;
			height: 75%;
			fill: var(--audio-player-text);
		}

		.tap--progress--bar {
			flex: 1;
			height: 24px;
			background-color: var(--audio-player-progress);
			border-radius: 12px;
			margin: 0;
			cursor: pointer;
			position: relative;
			overflow: hidden;
		}

		.tap--progress--playhead {
			border-radius: 0 12px 12px 0;
			position: absolute;
			top: 0;
			left: 0;
			height: 100%;
			width: 0%;
			pointer-events: none;
			transition: width 0.2s;
		}

		.tap--progress--playhead {
			box-shadow: 0 0 32px rgba(0, 0, 0, 0.75);
		}

		.tap--progress--timestamp {
			font-weight: 700;
			font-family: monospace;
			margin: 0 8px;
			color: var(--audio-player-text);
			user-select: none;
		}

		.loading {
			animation: 1s infinite loading linear;
		}

		@keyframes loading {
			from { transform: rotate(0); }
			to { transform: rotate(360deg); }
		}

		@media (max-width: 640px) {
			.tap--metadata__title {
				font-size: 24px;
			}
			.tap--metadata__artist {
				font-size: 18px;
			}
			.tap--container .tap--controls {
				margin: 8px;
			}
			.controls-text {
				margin-right: 4px;
			}
		}
		`;
    }
    addOverlayToContainer(t) {
      if (this.#n) return;
      let a = e.createElement({
        tagName: "img",
        className: "tap--img",
        src: this.getAttribute("image") || ""
      }), i = this.getAttribute("blurred");
      if ((i === null ? !!(this.#s && this.#e && this.#a) : i !== "false") && a.classList.add("blurred"), t.appendChild(a), !(this.#s || this.#e || this.#a)) return;
      let l = e.createElement({ className: "tap--overlay" }), o = e.createElement({ className: "tap--metadata" }), d = e.createElement({
        tagName: "span",
        className: "tap--metadata__title",
        textContent: this.#s
      }), n = "";
      this.#e === null && this.#a !== null ? n = this.#a : this.#e !== null && this.#a === null ? n = this.#e : this.#e !== null && this.#a !== null && (n = `from ${this.#a}, by ${this.#e}`);
      let r = e.createElement({
        tagName: "span",
        className: "tap--metadata__artist",
        textContent: n
      });
      o.appendChild(d), o.appendChild(r), t.appendChild(l), t.appendChild(o);
    }
    createControls() {
      let t = "TomboAudioPlayer" in window, a = e.createElement({ className: "tap--controls" });
      if (this.getAttribute("dark") !== null && a.classList.add("dark"), this.#i = e.createElement({
        tagName: "button",
        className: "tap--button",
        innerHTML: e.svgPlay
      }), a.appendChild(this.#i), this.#i.onclick = () => {
        if (t) {
          window.TomboAudioPlayer.addToPlaylistAndPlay({
            title: this.#s,
            artist: this.#e,
            album: this.#a,
            src: this.#t.src,
            imageSrc: this.getAttribute("image")
          });
          return;
        }
        if (!(this.#r && !this.#l)) {
          if (!this.#r) return this.play();
          this.pause();
        }
      }, t && a.appendChild(
        e.createElement({
          tagName: "span",
          className: "controls-text",
          textContent: "Play Now"
        })
      ), t) {
        let r = e.createElement({
          tagName: "button",
          className: "tap--button",
          innerHTML: e.svgPlus
        });
        return r.onclick = () => {
          window.TomboAudioPlayer.addToPlaylist({
            title: this.#s,
            album: this.#a,
            artist: this.#e,
            src: this.#t.src,
            imageSrc: this.getAttribute("image")
          });
        }, a.appendChild(r), a.appendChild(
          e.createElement({
            tagName: "span",
            className: "controls-text",
            textContent: "Add To Queue"
          })
        ), a;
      }
      let i = e.createElement({ className: "tap--progress--bar" }), s = e.createElement({ className: "tap--progress--playhead" }), l = e.createElement({ className: "tap--progress--timestamp" });
      s.style.backgroundColor = this.getAttribute("colour") || this.getAttribute("color") || "#3FA9F5", i.appendChild(s), a.appendChild(i), a.appendChild(l);
      let o = () => {
        let r = Number(this.getAttribute("length-secs") ?? 0), c = e.padTime(Math.floor(this.#t.currentTime / 60)), h = e.padTime(Math.floor(this.#t.currentTime % 60)), u = e.padTime(Math.floor((this.#t.duration || r) / 60)), g = e.padTime(Math.floor((this.#t.duration || r) % 60));
        l.innerHTML = `${c}:${h}<br/>${u}:${g}`, s.style.width = `${this.#t.currentTime * 100 / (this.#t.duration || 1)}%`;
      };
      o(), this.#t.ondurationchange = o, this.#t.ontimeupdate = o;
      let d = (r) => {
        let c = r.layerX / r.target.offsetWidth;
        if (this.#t.fastSeek) {
          this.#t.fastSeek(this.#t.duration * c);
          return;
        }
        this.#t.currentTime = this.#t.duration * c;
      }, n = !1;
      return i.onmousedown = () => {
        n = !0;
      }, i.onmouseup = () => {
        n = !1;
      }, i.onmousemove = (r) => n && d(r), i.onclick = d, a;
    }
    connectedCallback() {
      this.#o.innerHTML = "", this.#o.appendChild(e.createElement({ tagName: "style", textContent: this.styleCss }));
      let t = e.createElement({ className: "tap--container" });
      if (!this.#n) {
        let i = Number(this.getAttribute("min-height") ?? 280), s = Number.isSafeInteger(i) ? i : 280;
        t.style.minHeight = `${s}px`;
      }
      this.addOverlayToContainer(t);
      let a = this.createControls();
      if (this.#n) {
        this.#o.appendChild(a);
        return;
      }
      t.appendChild(a), this.#o.appendChild(t);
    }
    async play() {
      this.#r = !0, this.#t.readyState <= 1 && (this.#t.load(), this.#i.innerHTML = e.svgLoading), await this.#t.play(), this.#l = !0, this.#i.innerHTML = e.svgPause;
    }
    pause() {
      this.#t.pause(), this.#r = !1, this.#i.innerHTML = e.svgPlay;
    }
    stop() {
      this.pause(), this.#t.currentTime = 0;
    }
  };
  window.customElements.define("audio-player", p);
})();
